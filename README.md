# Define Style Fixer (VS Code Extension)


## Короткое ТЗ по плагину **Define Style Fixer (JS)**

### 1. Общие сведения

- **IDE:** Visual Studio Code  
- **Язык реализации плагина:** JavaScript (Node.js API VS Code)  
- **Название плагина:** Define Style Fixer (JS)  
- **Назначение:** Автоматическое приведение имён макросов `#define` в C/C++-коде к стилю `UPPER_SNAKE_CASE` и обновление их использований в текущем файле.

---

### 2. Функциональные требования

Плагин должен работать для файлов следующих языков:

- C (`onLanguage:c`)
- C++ (`onLanguage:cpp`)
- Objective-C (`onLanguage:objective-c`)
- Objective-C++ (`onLanguage:objective-cpp`)

Плагин должен предоставлять команду:

- идентификатор: `defineStyleFixer.fixFile`
- отображаемое имя: **Define Style Fixer: Fix Current File**
- команда должна быть доступна через палитру команд VS Code.

При запуске команды плагин должен:

1. Проанализировать активный документ.
2. Найти все строки вида `#define ИМЯ ...`, где `ИМЯ` — C-подобный идентификатор.
3. Преобразовать `ИМЯ` к виду `UPPER_SNAKE_CASE` (ALL_CAPS_WITH_UNDERSCORES).
4. Найти все использования старых имён макросов в том же файле и заменить их на новые имена.
5. Применить все правки к документу единым набором (через `WorkspaceEdit`).

Сообщения пользователю:

- Если изменений нет, плагин должен вывести сообщение:  
  `Define Style Fixer: ничего не нужно менять.`
- В случае успешного применения правок плагин должен вывести сообщение:  
  `Define Style Fixer: применено изменений: N.`  
  где `N` — количество замен.

---

### 3. Ограничения и допущения

Плагин **не обязан**:

- обрабатывать параметры макросов (например, `#define FOO(x, y)`);
- корректно работать с многострочными макросами с `\` в конце строк;
- анализировать связи между файлами (работа только в пределах одного открытого документа).

Плагин **не должен**:

- модифицировать идентификаторы, не связанные с `#define`, кроме использований переименованных макросов.

Плагин должен быть работоспособен в VS Code версии **1.85.0** и выше.

---

### 4. Нефункциональные требования

- Простой и понятный интерфейс (одна команда).
- Работоспособность на файлах разумного размера (обычные C/C++-файлы проекта).
- Исходный код плагина должен быть размещён в общедоступном репозитории (например, GitHub) с документацией и README.


## 1. Описание

**Define Style Fixer** — это расширение для Visual Studio Code, которое помогает приводить макросы `#define` к оформлению в стиле Google C++ (ALL_CAPS_WITH_UNDERSCORES).

Плагин работает с C/C++-кодом и выполняет две основные задачи:

1. Приводит имена макросов в строках `#define` к виду `UPPER_SNAKE_CASE`.
2. Обновляет все использования этих макросов в текущем файле, чтобы код продолжал компилироваться.

Пример:

```cpp
до:

#define max_size 1024

int main() {
    int buffer[max_size];

    ...
}

после:

#define MAX_SIZE 1024

int main() {
    int buffer[MAX_SIZE];

    ...
}
```

## Установка

- Открыть папку с плагином в VS Code
- Запустить режим разработки расширения:
  - нажать `F5` (запустится отдельное окно **Extension Development Host**)
- (опционально) Для установки как обычного расширения можно собрать `.vsix` через `vsce package` и установить его через `Extensions` → `Install from VSIX...`.

## Использование

- Открыть файл с кодом на C/C++
- Вызвать команду:  
  - через `Ctrl + Shift + P` -> `Define Style Fixer: Fix Current File`
  - или через горячую клавишу, если она назначена
- Плагин:
  - найдёт все строки `#define`
  - приведёт имена макросов к `UPPER_SNAKE_CASE`
  - заменит все вхождения старых имён макросов в этом файле на новые

## Код плагина в `extension.js`:

- `toUpperSnake(raw)` - переводит строку в формат `UPPER_SNAKE_CASE`
- `collectDefineEdits(document)` - находит все `#define` в документе, строит список правок и заменяет:
  - имена в строках `#define`
  - все использования макросов в остальном тексте файла
- `activate(context)` - точка входа расширения, регистрирует команду `defineStyleFixer.fixFile` и применяет правки к активному редактору

## Конфигурация команды в `package.json`:

Содержит:
- идентификатор команды `defineStyleFixer.fixFile`,
- отображаемое имя `Define Style Fixer: Fix Current File`,
- список языков, для которых активируется расширение (C/C++/Objective-C).

## История коммитов:

- `3d556bc7486969b08dd43063062d134ff395a156` - Initial commit: VS Code Define Style Fixer
- `d8c07c0d4a20b547879bd7c3e99feff816b55a8c` - Fix extension